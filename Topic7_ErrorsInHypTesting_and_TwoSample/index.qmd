---
title: "Topic 7: Inference for the Difference in Means"
format: 
  revealjs:
    theme: OSU.scss
    chalkboard: false
    html-math-method: mathjax
    multiplex: true
editor: visual
---

```{r}
library(tidyverse)
```

```{r}
AB_test <- read_csv("AB_test.csv")
A <- AB_test |>
  filter(version == "A")
B <- AB_test |>
  filter(version == "B")
```

## Difference of Two Means

::: fragment
**Motivating Example:** A/B testing is a user experience research methodology where two variants of a page are shown to users at random. A company wants to evaluate whether users will spend more time, on average, on page that uses the company's standard design or on a page with an updated modern design using an A/B test.
:::

## Difference of Two Means

::: fragment
**The data:** To answer this question, the 65 study participants are randomly assigned to view a webpage either using the standard design or the updated design.

-   33 participants viewed the page with the standard design. These participants spent an average of 1.77 minutes on the page, with a standard deviation of 1.68 minutes.

-   32 participants viewed the page with updated design. These participants spent an average of 2.22 minutes on the page, with a standard deviation of 2.09 minutes.
:::

## Difference of Two Means

:::{.columns}
:::{.column width=70%}
```{r}
#| fig-height: 4
ggplot(A, aes(x = time)) + 
  geom_histogram(binwidth = 1, 
                 fill = "lightblue", 
                 color = "black", 
                 boundary = 0) + 
  labs(x = "Time Spend on Standard Site (min)") + 
  theme(axis.title = element_text(size = 18)) + 
  xlim(0,8)
```

```{r}
#| fig-height: 4
ggplot(B, aes(x = time)) + 
  geom_histogram(binwidth = 1, 
                 fill = "red", 
                 color = "black", 
                 boundary = 0) + 
  labs(x = "Time Spent on Updated Site (min)") +
  theme(axis.title = element_text(size = 18)) + 
  xlim(0,8)
```

:::

:::{.column width=30%}
$$\overline{x}_S = 1.77 \text{ min}$$
$$ s_S = 1.68 \text{ min}$$
$$n_S = 33$$
¬†

$$\overline{x}_U = 2.22 \text{ min}$$
$$s_U = 2.09 \text{ min}$$
$$n_U = 32$$

:::
:::

# Estimation

##  {.smaller}

### A Confidence Interval for the Difference in Means, $\mu_1-\mu_2$

::: incremental
1.  Calculate the point estimate, [$\overline{x}_1 - \overline{x}_2$]{.fragment style="color:red;"}

2.  Identify the confidence level, $CL$, and the error associated with this confidence level $100-CL$.

3.  Determine the critical value, $t^*$, by finding the $CL + \frac{100-CL}{2}$ percentile on the t distribution with [$\nu$]{style="color:red;"} degrees of freedom (df).

    -   [$\nu$ represents the Satterthwaite degrees of freedom (see next slide)]{style="color:red;"}

4.  Calculate the standard error estimate from the observed sample:

[$$\sqrt{\frac{s_1^2}{n_1}+\frac{s_2^2}{n_2}}$$]{.fragment style="color:red;"}
:::

##  {.smaller}

### Sattherthwaite Degrees of Freedom, $\nu$

<iframe src="https://www.desmos.com/calculator/pz3s5ezbrn" width="1000" height="500">

</iframe>

*Link to this calculator and an R script alternative is available in the Week 8 Canvas module.*

## 

### Finding *t* Critical Values using `qt()`

¬†

`qt(p, df)` calculates the value on a *t* distribution curve with `df` degrees of freedom that has an area of `p` to the left of it.

¬†

::: fragment
**Example:** To find the critical value needed to construct a 99% confidence interval for the difference in means when $s_1 = 1.68$, $n_1 = 33$, $s_2 = 1.09$, $n_2 = 32$:

¬†

[`qt(0.995, 59.419)` = 2.661]{.fragment}
:::

## 

### Confidence Interval Construction for $\mu_1-\mu_2$

¬†

¬†

::: {style="text-align: center"}
[($\overline{x}_1 - \overline{x}_2)$]{.fragment} [$\pm$]{.fragment} [$t^*_{\nu}$]{.fragment} [$\sqrt{\frac{s_1^2}{n_1}+\frac{s_2^2}{n_2}}$]{.fragment}
:::

¬†

[**Motivating Example:** Construct the 99% confidence interval for the difference in the mean time spent on the Standard Site and the Updated Site.]{.fragment style="color:blue;"}

¬†

::: {style="text-align: center"}
[($1.77-2.22)$]{.fragment style="color:blue;"} [$\pm$]{.fragment style="color:blue;"} [$2.661$]{.fragment style="color:blue;"} [$\sqrt{\frac{1.68^2}{33}+\frac{2.09^2}{32}}$$= (-1.70, 0.48)$]{.fragment style="color:blue;"}
:::

¬†

## Practice! üêì

¬†

¬†

Answer questions 1-6 on the **Class 15 Activity - Difference in Means** activity on Canvas.

¬†

*Leave the activity open. We'll come back to it.*

```{r}
library(countdown)
countdown(minutes = 7)
```

# Hypothesis Testing

## 

### Testing for a Difference in Means

::: incremental
-   We can perform a formal hypothesis test to answer questions concerning a difference in two population means.

-   We'll use the same steps introduced in our Introduction to Hypothesis Testing notes, but some of the details will differ in this new scenario.
:::

## 

### 1. Identify the question and parameter of interest.

¬†

[Motivating Example:]{.fragment style="color:blue;"}

[Is there a **difference** in the average amount of time users spend on the Standard Site vs. the Updated Site?]{.fragment style="color:blue;"}

¬†

[The parameter of interest:]{.fragment style="color:blue;"}

[The difference in the average amount of time spent on the two sites, $\mu_S - \mu_U$]{.fragment style="color:blue;"}

##  {.smaller}

### 2. Set up the null and alternative hypotheses

**Null hypothesis**

[$$H_0: \mu_1 = \mu_2$$]{.fragment}

**Alternative hypothesis:**

[*This depends on the question of interest.*]{.fragment}

::::::: fragment
:::::: columns
::: {.column width="33%"}
**Lower one-sided**

[Question of interest: Is the mean of population 1 less than the mean of population 2?]{.fragment}

[$H_A: \mu_1 <\mu_2$]{.fragment}
:::

::: {.column width="33%"}
**Upper one-sided**

[Question of interest: Is the mean of population 1 greater than the mean of population 2?]{.fragment}

[$H_A: \mu_1 >\mu_2$]{.fragment}
:::

::: {.column width="33%"}
**Two-sided**

[Question of interest: Is the mean of population 1 different from the mean of population 2?]{.fragment}

[$H_A: \mu_1 \neq\mu_2$]{.fragment}
:::
::::::
:::::::

## 

### 2. Set up the null and alternative hypotheses

¬†

[Motivating Example:]{.fragment style="color:blue;"}

¬†

[$H_0:$$\mu_S = \mu_U$]{.fragment style="color:blue;"}

¬†

[$H_A:\mu_S \neq \mu_U$]{.fragment style="color:blue;"}

## Practice! üêì

¬†

¬†

Answer questions 7-8 on the **Class 15 Activity - Difference in Means** activity on Canvas.

¬†

*Leave the activity open. We'll come back to it.*

```{r}
countdown(minutes = 2)
```

##  {.smaller}


### 3. Collect and summarize the data.

[**Motivating Example:**]{style="color:blue;"}

:::{.columns}
:::{.column width=70%}
```{r}
#| fig-height: 4
ggplot(A, aes(x = time)) + 
  geom_histogram(binwidth = 1, 
                 fill = "lightblue", 
                 color = "black", 
                 boundary = 0) + 
  labs(x = "Time Spend on Standard Site (min)") + 
  theme(axis.title = element_text(size = 18)) + 
  xlim(0,8)
```

```{r}
#| fig-height: 4
ggplot(B, aes(x = time)) + 
  geom_histogram(binwidth = 1, 
                 fill = "red", 
                 color = "black", 
                 boundary = 0) + 
  labs(x = "Time Spent on Updated Site (min)") +
  theme(axis.title = element_text(size = 18)) + 
  xlim(0,8)
```

:::

:::{.column width=30%}
:::{style="color:blue;"}
$$\overline{x}_S = 1.77 \text{ min}$$
$$ s_S = 1.68 \text{ min}$$
$$n_S = 33$$
:::

¬†

¬†

:::{style="color:blue;"}
$$\overline{x}_U = 2.22 \text{ min}$$
$$s_U = 2.09 \text{ min}$$
$$n_U = 32$$
:::
:::
:::


## 4. Determine the Null Distribution {.smaller}

¬†

[If the sample sizes are sufficiently large, under the null hypothesis, the distribution of the test statistic used in testing the difference between two population means is a]{.fragment}

[t distribution with $\nu$ degrees of freedom.]{.fragment style="color:red;"}

[$\nu$ represents the Satterthwaite degrees of freedom.]{.fragment}

¬†

[How large do the samples need to be?]{.fragment}

::: incremental
-   If both $n_1\geq 30$ and $n_2 \geq 30$, we can move forward.

-   If either $n_1 < 30$ or $n_2 < 30$, we need to look at the **sampled distribution(s)** of the small sample(s). If there are no clear outliers or strong skewness in the sampled data, we can move forward. If either sampled distribution suggests skewness or outliers, we should not proceed.
:::

## 4. Determine the Null Distribution {.smaller}

:::::: columns
::: {.column width="50%"}
[Motivating Example:]{.fragment style="color:blue;"}

[Are the sample sizes sufficiently large?]{.fragment style="color:blue;"}

[Yes, both $n_1\geq$ and $n_2\geq30$.]{.fragment style="color:blue;"}

¬†

[So the null distribution is a**t distribution with 59.419 degrees of freedom**.]{.fragment style="color:blue;"}
:::

:::: {.column width="50%"}
::: fragment
```{r}
#| message: false
#| fig-height: 6

library(latex2exp)

ggplot(data = data.frame(x = c(-3, 3)), aes(x)) +
  stat_function(fun = dt, n = 101, args = list(df=59.419), color = "blue", linewidth = 2) + 
  # geom_area(stat = "function", 
  #           fun = dt,
  #           args = list(df=50),
  #           fill = "purple", 
  #           alpha = .5,
  #           xlim = c(-3, -1.5)) + 
  ylab("") +
  xlab("") + 
  theme_bw() +
  theme(axis.text.x = element_text(size = 18, color = "blue", face = "bold")) + 
  scale_y_continuous(breaks = NULL) + 
  scale_x_continuous(breaks = seq(-2,2,1), 
                     labels = c(-2,
                                -1, 
                                0, 
                                1, 
                                2))
  # geom_segment(aes(x = -1.5, y = 0, xend = -1.5, yend = 0.25), 
  #              size = 1.5) + 
  # geom_text(x=-2, y=0.27, label="t test statistic", size = 5)
```
:::
::::
::::::

##  {.smaller}

### 5. Calculate the test statistic

[When testing the difference in population means, $\mu_1$ vs. $\mu_2$, the test statistic is]{.fragment}

¬†

[$$t = \frac{\overline{x}_1-\overline{x}_2}{\sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}}$$]{.fragment}

¬†

## Participation Question üìä

¬†

Compute the test statistic for our motivating example problem.

¬†

**Answer the question at PollEv.com/erinhowardstats**

![](pollev_qr.png){fig-alt="QR code to PollEv.com/erinhowardstats"}

¬†

```{r}
countdown(minutes = 2)
```

##  {.smaller}

### 5. Calculate the test statistic

When testing the difference in population means, $\mu_1$ vs. $\mu_2$, the test statistic is

¬†

$$t = \frac{\overline{x}_1-\overline{x}_2}{\sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}}$$

¬†

[Motivating Example:]{style="color:blue;"}

[$$t = \frac{1.77-2.22}{\sqrt{\frac{1.68^2}{33} + \frac{2.09^2}{32}}} = -0.955$$]{.fragment style="color:blue;"}

##  {.smaller}

### 6. Calculate the p-value using the test statistic and null distribution.

:::::::: columns
::: {.column width="30%"}
[**Lower one-sided**:]{.fragment fragment-index="2"}

[$H_A: \mu_1<\mu_2$]{.fragment fragment-index="2"}
:::

::: {.column width="5%"}
:::

::: {.column width="30%"}
[**Upper one-sided**:]{.fragment fragment-index="2"}

[$H_A: \mu_1>\mu_2$]{.fragment fragment-index="2"}
:::

::: {.column width="5%"}
:::

::: {.column width="30%"}
[**Two-sided**:]{.fragment fragment-index="2"}

[$H_A: \mu_1\neq \mu_2$]{.fragment fragment-index="2"}
:::
::::::::

::::::::::: columns
:::: {.column width="30%"}
::: fragment
```{r}
#| message: false

library(latex2exp)
p <- 0.25
s <- sqrt((p*(1-p))/100)
ggplot(data = data.frame(x = c(-3, 3)), aes(x)) +
  stat_function(fun = dt, n = 101, args = list(df=50), color = "purple", linewidth = 2) + 
  geom_area(stat = "function", 
            fun = dt,
            args = list(df=50),
            fill = "purple", 
            alpha = .5,
            xlim = c(-3, -1.5)) + 
  ylab("") +
  xlab("") + 
  theme_bw() +
  theme(axis.text.x = element_text(size = 18, color = "purple", face = "bold")) + 
  scale_y_continuous(breaks = NULL) + 
  scale_x_continuous(breaks = seq(-2,2,1), 
                     labels = c(-2,
                                -1, 
                                0, 
                                1, 
                                2)) + 
  geom_segment(aes(x = -1.5, y = 0, xend = -1.5, yend = 0.25), 
               size = 1.5) + 
  geom_text(x=-2, y=0.27, label="t test statistic", size = 5)
```
:::
::::

::: {.column width="5%"}
:::

:::: {.column width="30%"}
::: fragment
```{r}
#| message: false

library(latex2exp)
p <- 0.25
s <- sqrt((p*(1-p))/100)
ggplot(data = data.frame(x = c(-3, 3)), aes(x)) +
  stat_function(fun = dt, n = 101, args = list(df=50), color = "purple", linewidth = 2) + 
  geom_area(stat = "function", 
            fun = dt,
            args = list(df=50),
            fill = "purple", 
            alpha = .5,
            xlim = c(1.5, 3)) + 
  ylab("") +
  xlab("") + 
  theme_bw() +
  theme(axis.text.x = element_text(size = 18, color = "purple", face = "bold")) + 
  scale_y_continuous(breaks = NULL) + 
  scale_x_continuous(breaks = seq(-2,2,1), 
                     labels = c(-2,
                                -1, 
                                0, 
                                1, 
                                2)) + 
  geom_segment(aes(x = 1.5, y = 0, xend = 1.5, yend = 0.25), 
               size = 1.5) + 
  geom_text(x=2, y=0.27, label="t test statistic", size = 5)
```
:::
::::

::: {.column width="5%"}
:::

:::: {.column width="30%"}
::: fragment
```{r}
#| message: false

library(latex2exp)
p <- 0.25
s <- sqrt((p*(1-p))/100)
ggplot(data = data.frame(x = c(-3, 3)), aes(x)) +
  stat_function(fun = dt, n = 101, args = list(df=50), color = "purple", linewidth = 2) + 
  geom_area(stat = "function", 
            fun = dt,
            args = list(df=50),
            fill = "purple", 
            alpha = .5,
            xlim = c(1.5, 3)) + 
    geom_area(stat = "function", 
            fun = dt,
            args = list(df=50),
            fill = "purple", 
            alpha = .5,
            xlim = c(-3,-1.5)) +
  ylab("") +
  xlab("") + 
  theme_bw() +
  theme(axis.text.x = element_text(size = 18, color = "purple", face = "bold")) + 
  scale_y_continuous(breaks = NULL) + 
  scale_x_continuous(breaks = seq(-2,2,1), 
                     labels = c(-2,
                                -1, 
                                0, 
                                1, 
                                2)) + 
  geom_segment(aes(x = 1.5, y = 0, xend = 1.5, yend = 0.25), 
               size = 1.5) + 
  geom_text(x=2, y=0.27, label="|t test statistic|", size = 5) + 
  geom_segment(aes(x = -1.5, y = 0, xend = -1.5, yend = 0.25), 
               size = 1.5) + 
  geom_text(x=-2, y=0.27, label="-|t test statistic|", size = 5)
```
:::
::::
:::::::::::

::::::::::: columns
:::: {.column width="30%"}
::: fragment
R code:

`pt(t, df)`
:::
::::

::: {.column width="5%"}
:::

:::: {.column width="30%"}
::: fragment
R code:

`1-pt(t, df))`
:::
::::

::::: {.column width="35%"}
:::: fragment
::: right-align
R code:

`2*(1-pt(abs(t), df))`
:::
::::
:::::
:::::::::::

[where `df` is the Satterthwaite degrees of freedom, $\nu$]{.fragment}

## Participation Question üìä

¬†

¬†

**Answer the question at PollEv.com/erinhowardstats**

![](pollev_qr.png){fig-alt="QR code to PollEv.com/erinhowardstats"}

¬†

```{r}
countdown(minutes = 1, seconds = 30)
```

##  {.smaller}

### 6. Calculate the p-value using the test statistic and null distribution.

[Motivating Example:]{.fragment style="color:blue;"}

¬†

::: fragment
```{r}
#| message: false
#| fig-height: 4

library(latex2exp)

ggplot(data = data.frame(x = c(-3, 3)), aes(x)) +
  stat_function(fun = dt, n = 101, args = list(df=59.419), color = "blue", linewidth = 2) + 
  geom_area(stat = "function",
            fun = dt,
            args = list(df=59.4197),
            fill = "blue",
            alpha = .5,
            xlim = c(-3, -0.955)) +
  geom_area(stat = "function",
            fun = dt,
            args = list(df=59.419),
            fill = "blue",
            alpha = .5,
            xlim = c(0.955, 3)) +
  ylab("") +
  xlab("") + 
  theme_bw() +
  theme(axis.text.x = element_text(size = 18, color = "blue", face = "bold")) + 
  scale_y_continuous(breaks = NULL) + 
  scale_x_continuous(breaks = seq(-2,2,1), 
                     labels = c(-2,
                                -1, 
                                0, 
                                1, 
                                2)) + 
  geom_segment(aes(x = -0.955, y = 0, xend = -0.955, yend = 0.25), 
                size = 1.5) + 
  geom_text(x=-1.25, y=0.27, label="-0.955", size = 5) + 
  geom_segment(aes(x = 0.955, y = 0, xend = 0.955, yend = 0.25), 
                size = 1.5) + 
  geom_text(x=1.25, y=0.27, label="0.955", size = 5)
```
:::

[`2*(1-pt(abs(-0.955), 59.419))` = 0.343]{.fragment}

## 7. Make a conclusion

Write a 4-part conclusion. The conclusion should be written in the context of the problem and contain the following components:

::: incremental
1.  A statement for the strength of evidence in favor the alternative hypothesis.

2.  Whether to reject or fail to reject the null hypothesis.

3.  The point estimate for the parameter of interest.

4.  A $(1-\alpha)100\%$ confidence interval estimate for the parameter of interest.
:::

## 7. Make a conclusion {.smaller}

### A statement in terms of the alternative hypothesis

::: incremental
-   Using terms like "reject" and "fail to reject the null" may be confusing to novice readers.
-   We‚Äôll provide a more complete conclusion by providing a statement of evidence in terms of the alternative hypothesis that reflects the question of interest.
:::

::: fragment
![](pval.png)
:::

## 7. Make a conclusion

[Motivating Example: Write a 4-part conclusion with a $\alpha=0.01$ significance level.]{.fragment style="color:blue;"}

[1. There is *no* evidence that the mean time spent on the Standard Site differs from the mean time spent on the Updated Site.]{.fragment style="color:blue;"}

[2. At the $\alpha=0.01$ significance level, we fail to reject the null hypothesis.]{.fragment style="color:blue;"}

[3. and 4. We are 99% confident that the users spend 1.70 minutes **less** to 0.48 minutes **more** on the Standard Site than on the Updated Site, on average, with an estimated difference of 0.45 more minutes spent on the Updated Site on average.]{.fragment style="color:blue;"}
